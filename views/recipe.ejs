<div class="container">
  <% if (error !== null) { %>
  <div class="error"><%= error %></div>
  <% } else if (recipe) { %>
  <div class="recipe-detail">
    <div class="recipe-header">
      <h1><%= recipe.strMeal %></h1>
      <img
        src="<%= recipe.strMealThumb %>"
        alt="<%= recipe.strMeal %>"
        class="recipe-image"
      />
    </div>

    <div class="recipe-info">
      <div class="recipe-category">
        <h3>Category:</h3>
        <p><%= recipe.strCategory %></p>
      </div>
      <div class="recipe-area">
        <h3>Cuisine:</h3>
        <p><%= recipe.strArea %></p>
      </div>
    </div>

    <div class="recipe-ingredients">
      <h3>Ingredients:</h3>
      <ul>
        <% for(let i = 1; i <= 20; i++) { %> <% if(recipe[`strIngredient${i}`]
        && recipe[`strIngredient${i}`].trim() !== '') { %>
        <li>
          <%= recipe[`strMeasure${i}`] %> <%= recipe[`strIngredient${i}`] %>
        </li>
        <% } %> <% } %>
      </ul>
    </div>

    <div class="recipe-instructions">
      <h3>Instructions:</h3>
      <p><%= recipe.strInstructions %></p>
    </div>

    <% if (locals.user) { %>
    <div class="rating-section">
      <h3>Rate this recipe</h3>
      <form
        action="/recipe/<%= recipe.idMeal %>/rate"
        method="POST"
        class="rating-form"
      >
        <div class="rating-input">
          <div class="stars">
            <input type="radio" id="star5" name="rating" value="5" required />
            <label for="star5" title="5 stars">★</label>
            <input type="radio" id="star4" name="rating" value="4" />
            <label for="star4" title="4 stars">★</label>
            <input type="radio" id="star3" name="rating" value="3" />
            <label for="star3" title="3 stars">★</label>
            <input type="radio" id="star2" name="rating" value="2" />
            <label for="star2" title="2 stars">★</label>
            <input type="radio" id="star1" name="rating" value="1" />
            <label for="star1" title="1 star">★</label>
          </div>
        </div>
        <div class="form-group">
          <label for="comment">Comment (optional):</label>
          <textarea id="comment" name="comment" rows="3"></textarea>
        </div>
        <button type="submit" class="button">Submit Rating</button>
      </form>
    </div>
    <% } else { %>
    <div class="login-prompt">
      <p>Please <a href="/login">login</a> to rate this recipe.</p>
    </div>
    <% } %> <% if (ratings && ratings.length > 0) { %>
    <div class="ratings-list">
      <h3>User Ratings</h3>
      <% ratings.forEach(rating => { %>
      <div class="rating-item">
        <div class="rating-header">
          <span class="rating-user"><%= rating.username %></span>
          <div class="rating-stars">
            <% for(let i = 1; i <= 5; i++) { %>
            <span
              class="star <%= i <= parseInt(rating.rating) ? 'filled' : '' %>"
              >★</span
            >
            <% } %>
          </div>
        </div>
        <% if (rating.comment) { %>
        <p class="rating-comment"><%= rating.comment %></p>
        <% } %>
        <span class="rating-date"
          ><%= new Date(rating.created_at).toLocaleDateString() %></span
        >
      </div>
      <% }); %>
    </div>
    <% } %>

    <form class="reply-form" method="POST" action="">
      <textarea
        name="message"
        placeholder="Kirjoita vastaus..."
        required
      ></textarea>
      <button type="submit">Vastaa</button>
    </form>
  </div>
  <% } else { %>
  <div class="error">Recipe not found</div>
  <% } %>
</div>
